# プロジェクトの構成

![プロジェクトの構成](images/organizing.png)

Flaskはアプリケーションをどの様な構成にするかはあなた次第です。
これは私がFlaskを好む理由の一つですが、ソースコードの構成について幾つか
考えなければならない事があります。
Flaskアプリケーション全体を1つのソースファイルに収めることもできますし、
複数のパッケージに分割することも可能です。
ここでは、Flaskアプリケーション開発を容易にする為の構成パターンを幾つか
紹介します。

## 定義

それではまずこの章で登場する幾つかの用語を定義します。

レポジトリ
:   これはプロジェクトの起点ディレクトリです。これは本来バージョン管理シ
ステムで利用される用語ですが、この章ではプロジェクトの起点ディレクトリ
という意味で利用します。アプリケーションを動作させる際にこのディレクト
リ全ては必要ないでしょう。

パッケージ
:   これはアプリケーションコードを含むPythonパッケージです。
この章ではアプリケーションをパッケージとして構成する方法を詳しく説明し
ていきますが、今の所パッケージとはレポジトリ下にあるサブディレクトリだ
と思って構いません。

モジュール
:   モジュールは他のPythonファイルからインポート可能な単一のPythonファ
イルの事です。そして複数のモジュールをまとめた物がパッケージです。

**注記**

- Pythonモジュールについてはこちらを参照してください。
  [Python tutorial](http://docs.python.org/2/tutorial/modules.html)

- 同じページのこの節も参考になります。
  [section on packages](http://docs.python.org/2/tutorial/modules.html#packages).

## 構成パターン

### 単一モジュール
Flaskのサンプルコードを見ていくと、全てのソースコードを*app.py*という様
な単一ファイルに収めている例が多い事に気がつくでしょう。
これは処理するURLルーティングが数個で、ソースコードが数百行以下の早急な
プロジェクトで非常に役立ちます。

~~~
app.py
config.py
requirements.txt
static/
templates/
~~~

アプリケーションのロジックは上記の例では*app.py*に記述します。

### パッケージ
もう少し複雑なプロジェクトである場合、単一ファイルでは乱雑になってしま
うでしょう。
その様な場合モデルやフォームの為にクラスを定義する必要がありますし、
URLルーティングの処理と設定ファイルも分離した方が良いでしょう。
単一ファイルでの開発には限界があります。
複雑なプロジェクトの場合、アプリケーションのコンポーネントとして分離し
た内部モジュールをパッケージにまとめることが可能です。

~~~
config.py
requirements.txt
run.py
instance/
    config.py
yourapp/
    __init__.py
    views.py
    models.py
    forms.py
    static/
    templates/
~~~

上記に記載したディレクトリ構成は、アプリケーションに複数のコンポーネン
トを組み込むことが可能です。
モデル用のクラスは*models.py*に、URLルーティングは*views.py*、フォーム
は*forms.py*に定義されます。(フォームについては後の章で詳しく説明します)

以下はFlaskアプリケーションでよく見るファイルの一覧です。
既存のプロジェクトのファイルと重複してしまうかもしれませんが、これらは
多くのFlaskアプリケーションで共通して使われているファイル名です。

run.py
:   これは開発用サーバーを起動するスクリプトです。これを実行すると、パッ
    ケージをコピーしてアプリケーションを実行します。これは開発環境のみ
    で利用され、本番環境では必要ありません。

requirements.txt
:   これはアプリケーションが依存しているPythonパッケージの一覧です。開
発環境と本番環境でファイルを別けているかもしれません。

config.py
:   このファイルにはアプリケーションが必要とする設定情報を記述します。

/instance/config.py
:   このファイルには設定情報を記述し、バージョン管理を行いません。
ここにはAPIキーやデータベースへの接続パスワードなどを記述します。
また、このファイルにはアプリケーションインスタンス固有のパラメーターを
記述します。
例えば、config.pyに`DEBUG = False`と設定し、開発環境の
instance/config.pyには`DEBUG = True`と設定します。
このファイルはconfig.pyの後に読み込まれるのでパラメータは上書きされます。

/yourapp/
:   ここにはアプリケーションのパッケージを格納します。

/yourapp/__init__.py
:   このファイルではアプリケーションの初期化を行い、様々なコンポーネン
    トを呼び出します。

/yourapp/views.py
:    ここではURLルーティング処理を定義します。これはさらに
*yourapp/views/*というパッケージでモジュールを分割する事ができます。

/yourapp/models.py

:   ここではアプリケーションのモデルを定義します。views.pyと同じ様に複
数のモジュールに分割する事ができます。

/yourapp/static/
:   ここにはCSS、JavaScript、画像などのアプリケーションによって公開され
る静的ファイルを配置します。これらのファイルは既定では
example.com/static/というパスでアクセスできます。

/yourapp/templates/
:   ここには、アプリケーションが利用するJinja2テンプレートを配置します。

### ブループリント
ある時、関連するURLルーティングが増えてくる場合があります。
私と似た考えの人であれば*views.py*を複数のモジュールに分割し、パッケー
ジにまとめたいと思うかもしれません。
この時、ブループリントと呼ばれるアプリケーションの構成要素に分割するこ
とが可能です。

ブループリントは自己完結的なアプリケーションの構成要素です。
これはアプリケーションの内部でアプリケーションの様に振る舞います。
例えばアプリケーションは管理画面、フロントエンド、ユーザーダッシュボー
ドという様な複数のブループリントを持つことが可能です。
ブループリントはビューや静的ファイル、テンプレートなどのコンポーネント
をひとまとめにし、モデルやフォームはアプリケーション間で共有することが
できます。
ブループリントを活用したアプリケーション構成については後の章で詳しく説
明します。

## まとめ
- 小さいプロジェクトでは、アプリケーションを単一モジュールで実装すると
  良いよ。
- 大きなプロジェクトではモデル・ビュー・フォームなどのコンポーネントを
  パッケージにまとめる事もできるよ。
- ブループリントはアプリケーションを明確なコンポーネントで構成する為の
  素晴らしい手段です。


